<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Market Pro - B2B Marketplace</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        
        :root { 
            --primary: #2563eb; 
            --primary-dark: #1d4ed8;
            --secondary: #f59e0b;
            --dark: #1e293b;
            --text: #0f172a;
            --text-light: #64748b;
            --bg: #f1f5f9;
            --white: #ffffff;
            --border: #e2e8f0;
            --success: #10b981;
            --danger: #ef4444;
        }
        
        body { background: var(--bg); color: var(--text); line-height: 1.6; padding-bottom: 80px; }
        
        /* Loading */
        .loading {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: var(--primary); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 9999;
            color: white;
        }
        .loading i { font-size: 48px; margin-bottom: 16px; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .loading.hidden { opacity: 0; pointer-events: none; transition: opacity 0.5s; }
        
        /* Header */
        .top-bar {
            background: var(--primary-dark); color: white; padding: 8px 16px;
            font-size: 12px; display: flex; justify-content: space-between;
        }
        .main-header {
            background: var(--primary); padding: 16px; position: sticky; top: 0; z-index: 1000;
        }
        .header-top {
            display: flex; align-items: center; gap: 12px; margin-bottom: 12px;
        }
        .logo {
            color: white; text-decoration: none; font-size: 20px; font-weight: 800;
            display: flex; align-items: center; gap: 8px;
        }
        .logo i { color: var(--secondary); font-size: 28px; }
        
        .search-box {
            flex: 1; display: flex; background: white; border-radius: 8px; overflow: hidden;
        }
        .search-box input { flex: 1; border: none; padding: 12px; font-size: 14px; outline: none; }
        .search-box button { background: var(--secondary); border: none; padding: 0 16px; color: white; cursor: pointer; }
        
        .header-actions { display: flex; gap: 16px; align-items: center; }
        .header-btn { color: white; text-decoration: none; font-size: 12px; text-align: center; cursor: pointer; }
        .header-btn i { display: block; font-size: 20px; margin-bottom: 2px; }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; border: 2px solid white; cursor: pointer; }
        
        .category-tabs {
            display: flex; gap: 8px; overflow-x: auto; padding: 4px 0;
        }
        .category-tabs::-webkit-scrollbar { display: none; }
        .cat-tab {
            padding: 8px 16px; background: rgba(255,255,255,0.2); color: white;
            border: none; border-radius: 20px; font-size: 13px; cursor: pointer; white-space: nowrap;
        }
        .cat-tab.active, .cat-tab:hover { background: white; color: var(--primary); }
        
        /* Quick Actions */
        .quick-actions {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;
            padding: 16px; background: white; margin-bottom: 12px;
        }
        .quick-action { text-align: center; cursor: pointer; }
        .quick-icon {
            width: 56px; height: 56px; background: linear-gradient(135deg, var(--primary), #3b82f6);
            color: white; border-radius: 16px; display: flex; align-items: center; justify-content: center;
            font-size: 24px; margin: 0 auto 8px; box-shadow: 0 4px 15px rgba(37,99,235,0.3);
        }
        .quick-action span { font-size: 12px; color: var(--text); font-weight: 600; }
        
        /* Section */
        .section-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 16px; background: white;
        }
        .section-title { font-size: 18px; font-weight: 700; }
        .view-all { color: var(--primary); font-size: 14px; text-decoration: none; font-weight: 600; }
        
        /* Products */
        .products-scroll {
            display: flex; gap: 12px; padding: 0 16px 16px; overflow-x: auto;
            background: white;
        }
        .products-scroll::-webkit-scrollbar { display: none; }
        
        .product-card {
            min-width: 160px; background: white; border-radius: 12px;
            overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid var(--border);
            cursor: pointer;
        }
        .product-image {
            height: 160px; position: relative; display: flex; align-items: center;
            justify-content: center; font-size: 48px; color: white;
        }
        .product-badge {
            position: absolute; top: 8px; left: 8px; background: var(--danger);
            color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700;
        }
        .verified-badge {
            position: absolute; top: 8px; right: 8px; width: 24px; height: 24px;
            background: var(--success); color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 12px;
        }
        .product-info { padding: 12px; }
        .product-price { color: var(--primary); font-size: 18px; font-weight: 800; margin-bottom: 4px; }
        .product-price span { font-size: 12px; color: var(--text-light); font-weight: 400; }
        .product-title { font-size: 13px; height: 36px; overflow: hidden; margin-bottom: 8px; }
        .product-meta { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-light); }
        .product-rating { color: var(--secondary); }
        
        .products-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;
            padding: 0 16px 16px; background: white;
        }
        
        /* FAB */
        .fab {
            position: fixed; bottom: 90px; right: 20px; width: 56px; height: 56px;
            background: var(--primary); color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; box-shadow: 0 4px 15px rgba(37,99,235,0.4);
            cursor: pointer; border: none; z-index: 998;
        }
        
        /* Modal */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 2000; align-items: center; justify-content: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: white; border-radius: 20px; width: 100%; max-width: 450px;
            max-height: 90vh; overflow-y: auto;
        }
        .modal-header {
            background: var(--primary); color: white; padding: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .modal-header h3 { font-size: 20px; }
        .close-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        .modal-body { padding: 20px; }
        
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 12px; border: 2px solid var(--border);
            border-radius: 10px; font-size: 15px; outline: none;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color: var(--primary); }
        
        .image-upload {
            border: 2px dashed var(--border); border-radius: 12px; padding: 30px;
            text-align: center; cursor: pointer;
        }
        .image-upload i { font-size: 40px; color: var(--text-light); margin-bottom: 8px; }
        
        .btn-primary {
            width: 100%; padding: 14px; background: var(--primary); color: white;
            border: none; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer;
        }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
        
        /* Bottom Nav */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0; background: white;
            display: flex; justify-content: space-around; padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            padding: 4px 12px; color: var(--text-light); text-decoration: none; font-size: 12px;
        }
        .nav-item i { font-size: 22px; }
        .nav-item.active { color: var(--primary); }
        
        /* Toast */
        .toast {
            position: fixed; top: 100px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: var(--dark); color: white; padding: 14px 28px; border-radius: 50px;
            font-size: 14px; opacity: 0; transition: all 0.3s; z-index: 3000;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- Loading -->
    <div class="loading" id="loading">
        <i class="fas fa-globe"></i>
        <div>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <!-- Top Bar -->
    <div class="top-bar">
        <div><i class="fas fa-headset"></i> Ø§Ù„Ø¯Ø¹Ù…: +967 738 520 546</div>
        <div id="userStatus">Ø²Ø§Ø¦Ø±</div>
    </div>

    <!-- Header -->
    <header class="main-header">
        <div class="header-top">
            <a href="#" class="logo" onclick="location.reload()">
                <i class="fas fa-globe"></i>
                <span>Global Market</span>
            </a>
            
            <div class="search-box">
                <input type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬Ø§Øª..." id="searchInput" onkeyup="searchProducts(this.value)">
                <button onclick="search()"><i class="fas fa-search"></i></button>
            </div>
            
            <div class="header-actions">
                <div class="header-btn" onclick="showAuthModal()" id="signInBtn">
                    <i class="fas fa-user"></i>
                    <span>Ø¯Ø®ÙˆÙ„</span>
                </div>
                <div class="header-btn hidden" id="userMenuBtn">
                    <img src="" alt="" class="user-avatar" id="userAvatar" onclick="logout()">
                </div>
            </div>
        </div>
        
        <div class="category-tabs">
            <button class="cat-tab active" onclick="filterCategory('all')">Ø§Ù„ÙƒÙ„</button>
            <button class="cat-tab" onclick="filterCategory('electronics')">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</button>
            <button class="cat-tab" onclick="filterCategory('fashion')">Ø£Ø²ÙŠØ§Ø¡</button>
            <button class="cat-tab" onclick="filterCategory('home')">Ù…Ù†Ø²Ù„</button>
            <button class="cat-tab" onclick="filterCategory('beauty')">Ø¬Ù…Ø§Ù„</button>
            <button class="cat-tab" onclick="filterCategory('industrial')">ØµÙ†Ø§Ø¹Ø©</button>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="quick-action" onclick="showAddProductModal()">
                <div class="quick-icon"><i class="fas fa-plus"></i></div>
                <span>Ø£Ø¶Ù Ù…Ù†ØªØ¬</span>
            </div>
            <div class="quick-action" onclick="filterCategory('deals')">
                <div class="quick-icon"><i class="fas fa-fire"></i></div>
                <span>ØµÙÙ‚Ø§Øª</span>
            </div>
            <div class="quick-action" onclick="showToast('Ù‚Ø±ÙŠØ¨Ø§Ù‹')">
                <div class="quick-icon"><i class="fas fa-file-alt"></i></div>
                <span>Ø·Ù„Ø¨ Ø¹Ø±Ø¶</span>
            </div>
            <div class="quick-action" onclick="filterCategory('verified')">
                <div class="quick-icon"><i class="fas fa-check-circle"></i></div>
                <span>Ù…ÙˆØ«Ù‚</span>
            </div>
        </div>

        <!-- Hot Products -->
        <div class="section-header">
            <h2 class="section-title">ğŸ”¥ Ù…Ù†ØªØ¬Ø§Øª Ø³Ø§Ø®Ù†Ø©</h2>
            <a href="#" class="view-all">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
        </div>
        <div class="products-scroll" id="hotProducts">
            <div style="padding: 40px; text-align: center; color: var(--text-light); width: 100%;">
                <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
                <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            </div>
        </div>

        <!-- All Products -->
        <div class="section-header">
            <h2 class="section-title">ğŸ“¦ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
            <a href="#" class="view-all">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
        </div>
        <div class="products-grid" id="allProducts">
            <div style="grid-column: 1/-1; padding: 40px; text-align: center; color: var(--text-light);">
                <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
                <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            </div>
        </div>
    </main>

    <!-- FAB -->
    <button class="fab hidden" id="fabBtn" onclick="showAddProductModal()">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authModal" onclick="closeModal(event, 'authModal')">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
                <button class="close-btn" onclick="closeModal(null, 'authModal')">&times;</button>
            </div>
            <div class="modal-body">
                <button class="btn-primary" onclick="signInWithGoogle()" style="background: white; color: var(--text); border: 2px solid var(--border); margin-bottom: 16px;">
                    <img src="https://www.google.com/favicon.ico" width="20" style="vertical-align: middle; margin-left: 8px;">
                    Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Google
                </button>
                
                <div style="text-align: center; color: var(--text-light); margin: 16px 0;">Ø£Ùˆ</div>
                
                <p style="text-align: center; color: var(--text-light);">Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª</p>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal-overlay" id="addProductModal" onclick="closeModal(event, 'addProductModal')">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
                <button class="close-btn" onclick="closeModal(null, 'addProductModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="productForm" onsubmit="submitProduct(event)">
                    <div class="form-group">
                        <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>
                        <div class="image-upload" onclick="document.getElementById('productImage').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <div>Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©</div>
                            <input type="file" id="productImage" accept="image/*" style="display: none;" onchange="previewImage(this)">
                        </div>
                        <div id="imagePreview" style="margin-top: 10px;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ *</label>
                        <input type="text" id="prodName" required placeholder="Ù…Ø«Ø§Ù„: Ø³Ù…Ø§Ø¹Ø§Øª Ø¨Ù„ÙˆØªÙˆØ«">
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ù„ÙØ¦Ø© *</label>
                        <select id="prodCategory" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                            <option value="electronics">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                            <option value="fashion">Ø£Ø²ÙŠØ§Ø¡</option>
                            <option value="home">Ù…Ù†Ø²Ù„</option>
                            <option value="beauty">Ø¬Ù…Ø§Ù„</option>
                            <option value="industrial">ØµÙ†Ø§Ø¹Ø©</option>
                            <option value="sports">Ø±ÙŠØ§Ø¶Ø©</option>
                        </select>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Ø§Ù„Ø³Ø¹Ø± ($) *</label>
                            <input type="number" id="prodPrice" required placeholder="25.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ *</label>
                            <input type="number" id="prodMOQ" required placeholder="50">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ù„ÙˆØµÙ *</label>
                        <textarea id="prodDesc" rows="3" required placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn-primary" id="submitBtn">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Bottom Nav -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" onclick="showPage('home')">
            <i class="fas fa-home"></i>
            <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </a>
        <a href="#" class="nav-item" onclick="showPage('categories')">
            <i class="fas fa-th-large"></i>
            <span>Ø§Ù„ÙØ¦Ø§Øª</span>
        </a>
        <a href="#" class="nav-item" onclick="showPage('messages')">
            <i class="fas fa-comment-dots"></i>
            <span>Ø±Ø³Ø§Ø¦Ù„</span>
        </a>
        <a href="#" class="nav-item" onclick="showPage('profile')">
            <i class="fas fa-user"></i>
            <span>Ø­Ø³Ø§Ø¨ÙŠ</span>
        </a>
    </nav>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <script>
        // ==================== FIREBASE CONFIG ====================
        const firebaseConfig = {
            apiKey: "AIzaSyB650D7BDg0f4q7cf9kndvKW5Qz8H1nFj0",
            authDomain: "mymarket-ec08e.firebaseapp.com",
            projectId: "mymarket-ec08e",
            storageBucket: "mymarket-ec08e.firebasestorage.app",
            messagingSenderId: "529357774752",
            appId: "1:529357774752:web:1dc0b061541702e22f8ec5",
            measurementId: "G-E4DY747EB9"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // ==================== GLOBAL VARIABLES ====================
        let currentUser = null;
        let selectedImage = null;
        let products = [];

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('App started');
            
            // Auth state
            auth.onAuthStateChanged((user) => {
                console.log('Auth state:', user ? 'logged in' : 'logged out');
                if (user) {
                    currentUser = user;
                    updateUIForUser(user);
                } else {
                    currentUser = null;
                    updateUIForGuest();
                }
                document.getElementById('loading').classList.add('hidden');
            });

            // Load products
            loadProducts();
        });

        // ==================== AUTH FUNCTIONS ====================
        function updateUIForUser(user) {
            document.getElementById('signInBtn').classList.add('hidden');
            document.getElementById('userMenuBtn').classList.remove('hidden');
            document.getElementById('fabBtn').classList.remove('hidden');
            document.getElementById('userAvatar').src = user.photoURL || 'https://via.placeholder.com/36';
            document.getElementById('userStatus').textContent = user.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…';
            
            // Save to Firestore
            db.collection('users').doc(user.uid).set({
                name: user.displayName,
                email: user.email,
                photoURL: user.photoURL,
                lastLogin: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });
        }

        function updateUIForGuest() {
            document.getElementById('signInBtn').classList.remove('hidden');
            document.getElementById('userMenuBtn').classList.add('hidden');
            document.getElementById('fabBtn').classList.add('hidden');
            document.getElementById('userStatus').textContent = 'Ø²Ø§Ø¦Ø±';
        }

        function showAuthModal() {
            document.getElementById('authModal').classList.add('active');
        }

        function closeModal(e, modalId) {
            if (!e || e.target.id === modalId) {
                document.getElementById(modalId).classList.remove('active');
            }
        }

        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    showToast('âœ… Ù…Ø±Ø­Ø¨Ø§Ù‹ ' + result.user.displayName);
                    closeModal(null, 'authModal');
                })
                .catch((error) => {
                    console.error('Auth error:', error);
                    showToast('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                });
        }

        function logout() {
            if (confirm('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                auth.signOut();
                showToast('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
            }
        }

        // ==================== PRODUCTS ====================
        function loadProducts() {
            console.log('Loading products...');
            
            db.collection('products')
                .orderBy('createdAt', 'desc')
                .onSnapshot((snapshot) => {
                    console.log('Products loaded:', snapshot.size);
                    products = [];
                    snapshot.forEach((doc) => {
                        products.push({ id: doc.id, ...doc.data() });
                    });
                    renderProducts();
                }, (error) => {
                    console.error('Error loading products:', error);
                    // Show demo products if error
                    showDemoProducts();
                });
        }

        function showDemoProducts() {
            const demoProducts = [
                { id: '1', name: 'Ø³Ù…Ø§Ø¹Ø§Øª Ø¨Ù„ÙˆØªÙˆØ« Ù„Ø§Ø³Ù„ÙƒÙŠØ©', price: 12.50, moq: 50, category: 'electronics', imageUrl: null },
                { id: '2', name: 'Ù„Ø§Ø¨ØªÙˆØ¨ Ø§Ø­ØªØ±Ø§ÙÙŠ', price: 450.00, moq: 10, category: 'electronics', imageUrl: null },
                { id: '3', name: 'Ø£Ù‚Ù…Ø´Ø© Ù‚Ø·Ù†ÙŠØ©', price: 8.00, moq: 100, category: 'fashion', imageUrl: null },
                { id: '4', name: 'Ø£Ø«Ø§Ø« Ù…ÙƒØªØ¨ÙŠ', price: 350.00, moq: 5, category: 'home', imageUrl: null }
            ];
            products = demoProducts;
            renderProducts();
        }

        function renderProducts() {
            const hotContainer = document.getElementById('hotProducts');
            const allContainer = document.getElementById('allProducts');

            if (products.length === 0) {
                hotContainer.innerHTML = '<div style="padding: 40px; text-align: center; color: var(--text-light); width: 100%;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯</div>';
                allContainer.innerHTML = '<div style="grid-column: 1/-1; padding: 40px; text-align: center; color: var(--text-light);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯. Ø£Ø¶Ù Ø£ÙˆÙ„ Ù…Ù†ØªØ¬!</div>';
                return;
            }

            const gradients = {
                electronics: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                fashion: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                home: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                beauty: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                industrial: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
                sports: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
            };

            const createCard = (p, isHorizontal) => {
                const gradient = gradients[p.category] || gradients.electronics;
                const imageHtml = p.imageUrl ? 
                    `<img src="${p.imageUrl}" style="width: 100%; height: 100%; object-fit: cover;">` :
                    `<i class="fas fa-box"></i>`;
                
                if (isHorizontal) {
                    return `
                        <div class="product-card" onclick="viewProduct('${p.id}')">
                            <div class="product-image" style="background: ${gradient};">
                                ${imageHtml}
                                <span class="product-badge">Ø¬Ø¯ÙŠØ¯</span>
                            </div>
                            <div class="product-info">
                                <div class="product-price">$${p.price} <span>/ ${p.moq} Ù‚Ø·Ø¹Ø©</span></div>
                                <div class="product-title">${p.name}</div>
                                <div class="product-meta">
                                    <span>MOQ: ${p.moq}</span>
                                    <span class="product-rating"><i class="fas fa-star"></i> 4.8</span>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="product-card" onclick="viewProduct('${p.id}')">
                            <div class="product-image" style="background: ${gradient}; height: 140px;">
                                ${imageHtml}
                            </div>
                            <div class="product-info" style="padding: 10px;">
                                <div class="product-price" style="font-size: 16px;">$${p.price}</div>
                                <div class="product-title" style="font-size: 12px; height: 32px;">${p.name}</div>
                                <div class="product-meta" style="font-size: 11px;">
                                    <span>MOQ: ${p.moq}</span>
                                    <span style="color: var(--secondary);"><i class="fas fa-star"></i> 4.8</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
            };

            hotContainer.innerHTML = products.slice(0, 5).map(p => createCard(p, true)).join('');
            allContainer.innerHTML = products.map(p => createCard(p, false)).join('');
        }

        // ==================== ADD PRODUCT ====================
        function showAddProductModal() {
            if (!currentUser) {
                showAuthModal();
                return;
            }
            document.getElementById('addProductModal').classList.add('active');
        }

        function previewImage(input) {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            selectedImage = null;

            if (input.files && input.files[0]) {
                selectedImage = input.files[0];
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.innerHTML = `<img src="${e.target.result}" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 10px;">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function submitProduct(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...';

            try {
                const name = document.getElementById('prodName').value;
                const category = document.getElementById('prodCategory').value;
                const price = parseFloat(document.getElementById('prodPrice').value);
                const moq = parseInt(document.getElementById('prodMOQ').value);
                const description = document.getElementById('prodDesc').value;

                let imageUrl = null;

                // Upload image if selected
                if (selectedImage) {
                    const storageRef = storage.ref(`products/${currentUser.uid}/${Date.now()}_${selectedImage.name}`);
                    await storageRef.put(selectedImage);
                    imageUrl = await storageRef.getDownloadURL();
                }

                // Save to Firestore
                await db.collection('products').add({
                    name,
                    category,
                    price,
                    moq,
                    description,
                    imageUrl,
                    sellerId: currentUser.uid,
                    sellerName: currentUser.displayName,
                    sellerPhoto: currentUser.photoURL,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    views: 0
                });

                showToast('âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
                closeModal(null, 'addProductModal');
                document.getElementById('productForm').reset();
                document.getElementById('imagePreview').innerHTML = '';
                selectedImage = null;

            } catch (error) {
                console.error('Error:', error);
                showToast('âŒ Ø®Ø·Ø£: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬';
            }
        }

        // ==================== UTILITIES ====================
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function searchProducts(query) {
            if (!query) {
                renderProducts();
                return;
            }
            const filtered = products.filter(p => p.name.toLowerCase().includes(query.toLowerCase()));
            
            const allContainer = document.getElementById('allProducts');
            if (filtered.length === 0) {
                allContainer.innerHTML = '<div style="grid-column: 1/-1; padding: 40px; text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
                return;
            }
            
            // Re-render with filtered
            const gradients = {
                electronics: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                fashion: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                home: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                beauty: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                industrial: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
                sports: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
            };
            
            allContainer.innerHTML = filtered.map(p => {
                const gradient = gradients[p.category] || gradients.electronics;
                const imageHtml = p.imageUrl ? 
                    `<img src="${p.imageUrl}" style="width: 100%; height: 100%; object-fit: cover;">` :
                    `<i class="fas fa-box"></i>`;
                return `
                    <div class="product-card" onclick="viewProduct('${p.id}')">
                        <div class="product-image" style="background: ${gradient}; height: 140px;">
                            ${imageHtml}
                        </div>
                        <div class="product-info" style="padding: 10px;">
                            <div class="product-price" style="font-size: 16px;">$${p.price}</div>
                            <div class="product-title" style="font-size: 12px; height: 32px;">${p.name}</div>
                            <div class="product-meta" style="font-size: 11px;">
                                <span>MOQ: ${p.moq}</span>
                                <span style="color: var(--secondary);"><i class="fas fa-star"></i> 4.8</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterCategory(cat) {
            document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            if (cat === 'all') {
                renderProducts();
            } else {
                const filtered = products.filter(p => p.category === cat);
                const allContainer = document.getElementById('allProducts');
                
                if (filtered.length === 0) {
                    allContainer.innerHTML = '<div style="grid-column: 1/-1; padding: 40px; text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©</div>';
                    return;
                }
                
                // Re-render filtered
                const gradients = {
                    electronics: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    fashion: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                    home: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                    beauty: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                    industrial: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
                    sports: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
                };
                
                allContainer.innerHTML = filtered.map(p => {
                    const gradient = gradients[p.category] || gradients.electronics;
                    const imageHtml = p.imageUrl ? 
                        `<img src="${p.imageUrl}" style="width: 100%; height: 100%; object-fit: cover;">` :
                        `<i class="fas fa-box"></i>`;
                    return `
                        <div class="product-card" onclick="viewProduct('${p.id}')">
                            <div class="product-image" style="background: ${gradient}; height: 140px;">
                                ${imageHtml}
                            </div>
                            <div class="product-info" style="padding: 10px;">
                                <div class="product-price" style="font-size: 16px;">$${p.price}</div>
                                <div class="product-title" style="font-size: 12px; height: 32px;">${p.name}</div>
                                <div class="product-meta" style="font-size: 11px;">
                                    <span>MOQ: ${p.moq}</span>
                                    <span style="color: var(--secondary);"><i class="fas fa-star"></i> 4.8</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function viewProduct(id) {
            showToast('ğŸ“¦ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬: ' + id);
        }

        function showPage(page) {
            if (page !== 'home') {
                showToast('ğŸ“„ ' + page + ' - Ù‚Ø±ÙŠØ¨Ø§Ù‹');
            }
        }

        function search() {
            const query = document.getElementById('searchInput').value;
            searchProducts(query);
        }
    </script>
</body>
</html>
